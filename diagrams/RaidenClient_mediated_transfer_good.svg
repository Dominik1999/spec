<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="1220" height="1138" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[participant Initiator
participant Mediator1
participant Mediator2
participant Target

Note over Initiator: Wants to transfer \n 10 tokens to Target

Note over Mediator1: BP_I_0 (nonce=4, transferred=10,\n locked=5 locksroot_0)

Initiator -> Mediator1: LockedTransfer(MSG) \n (HTL, BP_I_1, initiator_address,\n target_address)

Note over Mediator1: BP_I_1 (nonce=5, transferred=10,\n locked=15 locksroot_1)

Mediator1 -> Mediator2: LockedTransfer(MSG) \n (HTL, BP_M1_1, initiator_address,\n target_address)
Mediator2 -> Target: LockedTransfer(MSG) \n (HTL, BP_M2_1, initiator_address,\n target_address)
Target -> Initiator: SecretRequest(MSG) \n (amount, secrethash,\n signature)
Initiator -> Target: RevealSecret(MSG) \n (secret, signature)
Target -> Mediator2: RevealSecret(MSG) \n (secret, signature)
Mediator2 -> Target: Unlock(MSG) BP_M2_2
Mediator2 -> Mediator1: RevealSecret(MSG) \n (secret, signature)
Mediator1 -> Mediator2: Unlock(MSG) BP_M1_2
Mediator1 -> Initiator: RevealSecret(MSG) \n (secret, signature)
Initiator -> Mediator1: Unlock(MSG) BP_I_2

Note over Mediator1: BP_I_2 (nonce=6, transferred=20,\n locked=5 locksroot_0)

Note over Mediator1: locked, locksroot can vary \n if there are other pending transfers
]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="55" y="20" width="110" height="39" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="65" y="45" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="65">Initiator</tspan></text></g><g class="actor"><rect x="55" y="1079.4000129699707" width="110" height="39" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="65" y="1104.4000129699707" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="65">Initiator</tspan></text></g><line x1="110" x2="110" y1="59" y2="1079.4000129699707" style="stroke-width: 2px;" stroke="#000000" fill="none"></line><g class="actor"><rect x="395" y="20" width="110" height="39" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="405" y="45" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="405">Mediator1</tspan></text></g><g class="actor"><rect x="395" y="1079.4000129699707" width="110" height="39" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="405" y="1104.4000129699707" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="405">Mediator1</tspan></text></g><line x1="450" x2="450" y1="59" y2="1079.4000129699707" style="stroke-width: 2px;" stroke="#000000" fill="none"></line><g class="actor"><rect x="745" y="20" width="110" height="39" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="755" y="45" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="755">Mediator2</tspan></text></g><g class="actor"><rect x="745" y="1079.4000129699707" width="110" height="39" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="755" y="1104.4000129699707" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="755">Mediator2</tspan></text></g><line x1="800" x2="800" y1="59" y2="1079.4000129699707" style="stroke-width: 2px;" stroke="#000000" fill="none"></line><g class="actor"><rect x="1110" y="20" width="80" height="39" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="1120" y="45" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="1120">Target</tspan></text></g><g class="actor"><rect x="1110" y="1079.4000129699707" width="80" height="39" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="1120" y="1104.4000129699707" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="1120">Target</tspan></text></g><line x1="1150" x2="1150" y1="59" y2="1079.4000129699707" style="stroke-width: 2px;" stroke="#000000" fill="none"></line><g class="note"><rect x="10" y="79" width="200" height="48.20000076293945" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="15" y="99" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="15">Wants to transfer</tspan><tspan dy="1.2em" x="15">10 tokens to Target</tspan></text></g><g class="note"><rect x="285" y="147.20000076293945" width="330" height="48.20000076293945" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="290" y="167.20000076293945" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="290">BP_I_0 (nonce=4, transferred=10,</tspan><tspan dy="1.2em" x="290">locked=5 locksroot_0)</tspan></text></g><g class="signal"><text x="120" y="206.70000076293945" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="120">LockedTransfer(MSG)</tspan><tspan dy="1.2em" x="120">(HTL, BP_I_1, initiator_address,</tspan><tspan dy="1.2em" x="120">target_address)</tspan></text><line x1="110" x2="450" y1="272.8000030517578" y2="272.8000030517578" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="285" y="292.8000030517578" width="330" height="48.20000076293945" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="290" y="312.8000030517578" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="290">BP_I_1 (nonce=5, transferred=10,</tspan><tspan dy="1.2em" x="290">locked=15 locksroot_1)</tspan></text></g><g class="signal"><text x="460" y="352.3000030517578" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="460">LockedTransfer(MSG)</tspan><tspan dy="1.2em" x="460">(HTL, BP_M1_1, initiator_address,</tspan><tspan dy="1.2em" x="460">target_address)</tspan></text><line x1="450" x2="800" y1="418.4000053405762" y2="418.4000053405762" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="810" y="429.7000045776367" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="810">LockedTransfer(MSG)</tspan><tspan dy="1.2em" x="810">(HTL, BP_M2_1, initiator_address,</tspan><tspan dy="1.2em" x="810">target_address)</tspan></text><line x1="800" x2="1150" y1="495.8000068664551" y2="495.8000068664551" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="530" y="507.1000061035156" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="530">SecretRequest(MSG)</tspan><tspan dy="1.2em" x="530">(amount, secrethash,</tspan><tspan dy="1.2em" x="530">signature)</tspan></text><line x1="1150" x2="110" y1="573.200008392334" y2="573.200008392334" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="535" y="594.1000080108643" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="535">RevealSecret(MSG)</tspan><tspan dy="1.2em" x="535">(secret, signature)</tspan></text><line x1="110" x2="1150" y1="631.4000091552734" y2="631.4000091552734" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="880" y="652.3000087738037" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="880">RevealSecret(MSG)</tspan><tspan dy="1.2em" x="880">(secret, signature)</tspan></text><line x1="1150" x2="800" y1="689.6000099182129" y2="689.6000099182129" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="880" y="720.1000099182129" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="880">Unlock(MSG) BP_M2_2</tspan></text><line x1="800" x2="1150" y1="728.6000099182129" y2="728.6000099182129" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="530" y="749.5000095367432" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="530">RevealSecret(MSG)</tspan><tspan dy="1.2em" x="530">(secret, signature)</tspan></text><line x1="800" x2="450" y1="786.8000106811523" y2="786.8000106811523" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="530" y="817.3000106811523" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="530">Unlock(MSG) BP_M1_2</tspan></text><line x1="450" x2="800" y1="825.8000106811523" y2="825.8000106811523" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="185" y="846.7000102996826" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="185">RevealSecret(MSG)</tspan><tspan dy="1.2em" x="185">(secret, signature)</tspan></text><line x1="450" x2="110" y1="884.0000114440918" y2="884.0000114440918" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="190" y="914.5000114440918" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="190">Unlock(MSG) BP_I_2</tspan></text><line x1="110" x2="450" y1="923.0000114440918" y2="923.0000114440918" style="stroke-width: 2px; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="285" y="943.0000114440918" width="330" height="48.20000076293945" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="290" y="963.0000114440918" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="290">BP_I_2 (nonce=6, transferred=20,</tspan><tspan dy="1.2em" x="290">locked=5 locksroot_0)</tspan></text></g><g class="note"><rect x="265" y="1011.2000122070312" width="370" height="48.20000076293945" style="stroke-width: 2px;" stroke="#000000" fill="#ffffff"></rect><text x="270" y="1031.2000122070312" style="font-size: 16px; font-family: Andale Mono, monospace;"><tspan x="270">locked, locksroot can vary</tspan><tspan dy="1.2em" x="270">if there are other pending transfers</tspan></text></g></svg>